var margin={top:20,right:120,bottom:20,left:120},width=1280-margin.right-margin.left,height=96000-margin.top-margin.bottom;var i=0,duration=750,root;var tree=d3.layout.tree().size([height,width]);var diagonal=d3.svg.diagonal().projection(function(a){return[a.y,a.x]});var svg=d3.select("#demo").append("svg").attr("width",width+margin.right+margin.left).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");d3.json("tree.json",function(a,b){console.log(b);if(a){throw a}var c={key:"拉勾网",values:d3.nest().key(function(e){return e.m0}).key(function(e){return e.m1}).key(function(e){return e.m2}).entries(b)};var b={name:"拉勾网",children:c.values.map(function(d){return{name:d.key,children:d.values.map(function(e){return{name:e.key,children:e.values.map(function(f){return{name:f.key,children:f.values}})}})}})};root=b;root.x0=height/2;root.y0=0;update(root)});d3.select(self.frameElement).style("height","500px");function update(g){var b=tree.nodes(root).reverse(),a=tree.links(b);b.forEach(function(j){j.y=j.depth*180});var f=svg.selectAll("g.node").data(b,function(j){return j.id||(j.id=++i)});var c=f.enter().append("g").attr("class","node").attr("transform",function(j){return"translate("+g.y0+","+g.x0+")"}).on("click",click);c.append("circle").attr("r",0.000001).style("fill",function(j){return j._children?"lightsteelblue":"#fff"});c.append("text").attr("x",function(j){return j.children||j._children?-13:13}).attr("dy",".35em").attr("text-anchor",function(j){return j.children||j._children?"end":"start"}).text(function(j){return j.name}).style("fill-opacity",0.000001);var e=f.transition().duration(duration).attr("transform",function(j){return"translate("+j.y+","+j.x+")"});e.select("circle").attr("r",6).style("fill",function(j){return j._children?"lightsteelblue":"#fff"});e.select("text").style("fill-opacity",1);var h=f.exit().transition().duration(duration).attr("transform",function(j){return"translate("+g.y+","+g.x+")"}).remove();h.select("circle").attr("r",0.000001);h.select("text").style("fill-opacity",0.000001);var d=svg.selectAll("path.link").data(a,function(j){return j.target.id});d.enter().insert("path","g").attr("class","link").attr("d",function(k){var j={x:g.x0,y:g.y0};return diagonal({source:j,target:j})});d.transition().duration(duration).attr("d",diagonal);d.exit().transition().duration(duration).attr("d",function(k){var j={x:g.x,y:g.y};return diagonal({source:j,target:j})}).remove();b.forEach(function(j){j.x0=j.x;j.y0=j.y})}function click(a){if(a.children){a._children=a.children;a.children=null}else{a.children=a._children;a._children=null}update(a)};